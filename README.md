Android Malware Detector(AMD)
===================

```
전체적인 프로젝트의 내용과 본인이 개발한 내용에 대해 집중적으로 작성했습니다.
```



<br></br>

![Imgur](http://i.imgur.com/oflUaVH.jpg)

<br></br>




##개발환경
-------------

| os     | tool   |language|
|:-------|:-------|:-------|
|Android |Android Studio, Strace, weka| Java|




##개발목표
-------------------

![Imgur](http://i.imgur.com/R6kE8eD.jpg)

#### 퍼미션 (정적 분석 방식)
안드로이드 OS에선 디바이스를 사용하기 위해 권한을 획득한 후 기능을 수행할 수 있다. SMS의 정보를 읽어오거나, 인터넷에 연결하는 등 보안에 민감한 퍼미션도 존재한다. 이런 퍼미션을 정리하여 악성 코드를 판별하는 지표로 사용한다.

#### 시스템 콜 (동적 분석 방식)
안드로이드의 퍼미션으로만 악성코드를 판별하기는 무리가 있기에, 보안 및 성능에 민감한 시스템 콜의 사용빈도, 종류를 분석한다. 시스템 콜을 수집하기 위해선 일반적인 어플리케이션이 작동하는 유저 레벨의 환경에서는 불가능하기 때문에, Strace라는 리눅스 디버깅 툴을 이용하여 수집한다.

#### 악성코드 여부 판별
수집한 정보들과 미리 학습된 데이터와 비교하여 악성코드를 포함하는 어플리케이션인지를 판별한다.

#### 권한 문제
본 프로젝트에서 제작할 어플리케이션이 다른 어플리케이션들에 대해 시스템 콜을 수집해야하기 때문에 어플리케이션 간 권한 관련 문제를 해결해야 한다.


##개발내용
-------------

#### 시스템 구성도

![Imgur](http://i.imgur.com/jGNXnI9.jpg)

본 어플리케이션에서 기기 내 설치된 어플리케이션들을 테스트 하여 시스템 콜에 대한 데이터를 수집하고, 안드로이드에서 제공하는 Package manager클래스에서 각 어플리케이션의 퍼미션 요구 정보를 가져올 수 있다.


<br></br>

<br></br>

#### 퍼미션 수집

![Imgur](http://i.imgur.com/C45eTU7.jpg)

안드로이드 API Package Manager 클래스에서 기기 내 설치된 어플리케이션들의 패키지 명, 퍼미션 정보를 가져올 수 있다.



#### Strace

![Imgur](http://i.imgur.com/L2bqAj9.jpg)

Strace는 시스템 콜 분석 도구이다. ptrace 라는 함수를 사용하여 특정 프로세스에 접근하거나, 특정 위치에 데이터를 읽거나 쓰는 등 여러가지 작업을 할 수 있다.



#### 시스템 콜 트레이싱 과정


![Imgur](http://i.imgur.com/2SuA70n.jpg)

본래 목적은 어플리케이션에서 다른 어플리케이션에 대해 Strace 명령어를 사용하여 시스템 콜을 수집하는 것이기 때문에 이런 작업을 가능하게 하려면 어플리케이션 혹은 Strace 명령어가 Root 권한이 필요하다.

-------------

![Imgur](http://i.imgur.com/Yw6xDfZ.jpg)

하지만 안드로이드 젤리빈(4.3) 이후 버전에는 SE Android 라는 리눅스 보안 강화 패치가 적용되어 어플리케이션에 의한 데이터 누출을 방지하거나 보안 모듈에 접근을 방지한다. 이는 본 어플리케이션이 Root권한을 가질 수 없게 하기 때문에 SE Android 정책을 사용하지 않는 상태에서 진행하거나, 젤리빈 이전의 버전을 사용해야 한다.

-------------

![Imgur](http://i.imgur.com/gV8fV3e.jpg)

Strace 명령어 파일에 SetUid 권한을 부여하여 Root권한이 필요할 때에만 잠시 권한을 빌려오는 방식으로 권한 관련 문제를 해결할 수 있다.



####윈도우 매니저

![Imgur](http://i.imgur.com/8dbzvAK.png)

본 어플리케이션은 다른 어플리케이션의 동작을 감시하는 구조이므로 조작 할 때마다 다른 어플리케이션으로 움직여야 하기 때문에 항상 떠있는 창을 구현하여 다른 어플리케이션을 실행하는 도중에도 조작이 가능하도록 구현하였다. 하지만 다른 기기에서 터치 인식이 동작하지 않는 문제가 발생하여 이 기능은 제대로 구현되지 못했다. 

